-- Создание таблиц
CREATE TABLE Authors (
    author_id serial PRIMARY KEY,
    author_name varchar(255) NOT NULL
);

CREATE TABLE Albums (
    album_id serial PRIMARY KEY,
    title varchar(255) NOT NULL,
    release_year int
);

CREATE TABLE AuthorAlbums (
    author_id int REFERENCES Authors(author_id),
    album_id int REFERENCES Albums(album_id),
    PRIMARY KEY (author_id, album_id)
);

CREATE TABLE Tracks (
    track_id serial PRIMARY KEY,
    title varchar(255) NOT NULL,
    duration_seconds int,
    album_id int REFERENCES Albums(album_id)
);

CREATE TABLE Genres (
    genre_id serial PRIMARY KEY,
    genre_name varchar(255) NOT NULL
);

CREATE TABLE Compilations (
    compilation_id serial PRIMARY KEY,
    compilation_name varchar(255) NOT NULL
);

CREATE TABLE CompilationTracks (
    compilation_id int REFERENCES Compilations(compilation_id),
    track_id int REFERENCES Tracks(track_id),
    PRIMARY KEY (compilation_id, track_id)
);

CREATE TABLE AuthorGenres (
    author_id int REFERENCES Authors(author_id),
    genre_id int REFERENCES Genres(genre_id),
    PRIMARY KEY (author_id, genre_id)
);

-- Вставка данных
INSERT INTO Authors (author_name) VALUES
    ('Автор 1'),
    ('Автор 2'),
    ('Автор 3');

INSERT INTO Genres (genre_name) VALUES
    ('Классика'),
    ('Попса'),
    ('Рок');

INSERT INTO Albums (title, release_year) VALUES
    ('Альбом 1', 2000),
    ('Альбом 2', 2010),
    ('Альбом 3', 1995);

-- Вставка данных в AuthorAlbums
INSERT INTO AuthorAlbums (author_id, album_id) VALUES
    (1, 1),
    (2, 2),
    (3, 3);

INSERT INTO Tracks (title, duration_seconds, album_id) VALUES
    ('Трек 1', 180, 1),
    ('Трек 2', 220, 1),
    ('Трек 3', 240, 2),
    ('Трек 4', 200, 2),
    ('Трек 5', 300, 3);

INSERT INTO Compilations (compilation_name) VALUES
    ('Сборник 1'),
    ('Сборник 2');

INSERT INTO CompilationTracks (compilation_id, track_id) VALUES
    (1, 1),
    (1, 2),
    (2, 3),
    (2, 4);

-- Ваши операторы SELECT
SELECT a.*,
       array_agg(DISTINCT g.genre_name) AS genres,
       array_agg(DISTINCT au.author_name) AS authors
FROM Albums a
LEFT JOIN AuthorAlbums aa ON a.album_id = aa.album_id
LEFT JOIN Authors au ON aa.author_id = au.author_id
LEFT JOIN Tracks t ON a.album_id = t.album_id
LEFT JOIN AlbumGenres ag ON a.album_id = ag.album_id
LEFT JOIN Genres g ON ag.genre_id = g.genre_id
GROUP BY a.album_id;

SELECT * FROM Authors;
SELECT * FROM Genres;
SELECT * FROM Albums;
SELECT * FROM Tracks;
SELECT * FROM Compilations;
SELECT * FROM CompilationTracks;
